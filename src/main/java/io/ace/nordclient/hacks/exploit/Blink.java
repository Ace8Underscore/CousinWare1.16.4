package io.ace.nordclient.hacks.exploit;

import io.ace.nordclient.event.PacketEvent;
import io.ace.nordclient.hacks.Hack;
import me.zero.alpine.listener.EventHandler;
import me.zero.alpine.listener.Listener;
import net.minecraft.network.play.client.CPlayerPacket;

import java.util.LinkedList;
import java.util.Queue;

public class Blink extends Hack {

    int delay = 0;
    Queue<CPlayerPacket> packets = new LinkedList<>();

    public Blink() {
        super("Blink", Category.EXPLOIT, 4490307, null);
    }

    @EventHandler
    private final Listener<PacketEvent.Send> listener = new Listener<>(event -> {
        if (event.getPacket() instanceof CPlayerPacket) {
            //if (delay <= 20) {
            event.setCanceled(true);
            packets.add((CPlayerPacket) event.getPacket());
            //}
        }
    });

    @Override
    public void onDisable() {
        while (!packets.isEmpty()) {
            mc.player.connection.sendPacket(packets.poll());
        }
    }

    @Override
    public void onUpdate() {
        delay++;
        if (delay > 20) {
            while (!packets.isEmpty()) {
                mc.player.connection.sendPacket(packets.poll());
                packets.clear();
                delay = 0;
            }
        }
    }
}
